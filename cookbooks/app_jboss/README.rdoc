= RightScale App Jboss Cookbook

== DESCRIPTION:

* Cookbook provides Jboss application server implementation of the app LWRP.
* Installs and configures, Jboss application server.

== REQUIREMENTS:
* Requires "app" Lightweight resource cookbook https://github.com/rightscale/rightscale_cookbooks/tree/master/cookbooks/app
  or your own implementation of "app" resource. See the "app" cookbook README for
  details.
* Requires a VM launched from a RightScale managed RightImage
* Tested on the following RightImages:
  * CentOS 6.2
  * Ubuntu 12.04

== COOKBOOKS DEPENDENCIES:
Please see the <tt>metadata.rb</tt> file for the latest dependencies.

* <tt>app</tt>
* <tt>db_mysql</tt>
* <tt>db_postgres</tt>
* <tt>repo</tt>
* <tt>rightscale</tt>

== KNOWN LIMITATIONS:

There are no known limitations.

== SETUP/USAGE:

* Place <tt>Jboss::default</tt> recipe into your runlist to set up the application server.
* When using a RightScale ServerTemplate, this will also automatically add the
  common attributes to your ServerTemplate inputs.
* Set 'jdbc/ConnDB' as your datasource name to set up a database connection with
  the application server.

For more info see: {Release Notes}[http://support.rightscale.com/18-Release_Notes/ServerTemplates_and_RightImages/current] (Section ‘Jboss App Server’ under ServerTemplates)

Please checkout the tutorial: {Jboss App Server}[http://support.rightscale.com/03-Tutorials/Jboss_App_Server]

== DETAILS:
=== General

The <tt>app_jboss</tt> cookbook will install and set up the Apache web server with a mod_jk module
and the Jboss application server, with support for MySQL or Postgres database servers.
The Cookbook will create a separate vhost config for the Apache web server, which will allow
Apache to handle static content, such as images and HTML documents, 
and forward all requests for dynamic content to jboss.


<b>Apache</b>

Server version: Apache/2.2.3

Server built: Jun 6 2012 10:00:42

<b>Apache Jboss</b>

Server.info=Apache Jboss/6.0.16

Server.number=6.0.16.0

Server.built=Feb 8 2008 10:50:49

Jboss Native library 1.1.20

mod_jk/1.2.32

<b>Java</b>

Java version "1.6.0_31"

Java(TM) SE Runtime Environment (build 1.6.0_31-b04)

Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)

also:
* <tt>User defined war file support</tt>
* <tt>Java heap size Xms and Xmx memory limitations tuning</tt>
* <tt>Java NewSize, MaxNewSize, PermSize, MaxPermSize limitations tuning</tt>
* <tt>Application code installation from the remote git, svn or ROS repository</tt>
* <tt>MySQL database db.tjboss connection file configuration</tt>
* <tt>Automatic application vhost file configuration</tt>
* <tt>Automatic logrotate file configuration for Jboss logs</tt>
* <tt>Collectd monitoring support</tt>

=== Attributes:
These are settings used in recipes and templates. Default values are noted.

Note: Only "internal" cookbook attributes are described here. Descriptions of
attributes that are inputs are in the <tt>metadata.rb</tt> cookbook file.

====== General attributes
* <tt>node[:app_tjboss][:code][:root_war]</tt> - Path to the directory which will contain the application for Jboss.

====== Java heap tuning attributes
* <tt>node[:app_jboss][:java][:permsize]</tt> - The initial value of the permanent generation space size.
* <tt>node[:app_jboss][:java][:maxpermsize]</tt> - The maximum value of the permanent generation space size.
* <tt>node[:app_jboss][:java][:newsize]</tt> - The initial size of new space generation.
* <tt>node[:app_jboss][:java][:maxnewsize]</tt> - The maximum size of new space generation.
* <tt>node[:app_jboss][:java][:xmx]</tt> - The maximum size of the heap used by the JVM.
* <tt>node[:app_jboss][:java][:xms]</tt> - The initial size of the heap used by the JVM.

====== Platform dependent
* <tt>node[:app][:user]</tt> - Username. Required for changing the owner
  of created project dirs.
* <tt>node[:app_jboss][:alternatives_cmd]</tt> - Java alternatives command list.

=== Templates:

==== Defined in <tt>:setup_vhost</tt> LWRP action for the <tt>app::setup_vhost</tt> recipe.

* <tt>apache_mod_jk_vhost.erb</tt> - Configuration for apache vhost file.
* <tt>mod_jk.conf.erb</tt> - Mod_jk configuration template.
* <tt>server_xml.erb</tt> - Jboss server.xml configuration template.
* <tt>jboss_conf.erb</tt> - Jboss.conf configuration template used in the
  <tt>app::setup_vhost</tt> recipe.
* <tt>jboss_workers.properties.erb</tt> - Jboss worker configuration template.

==== Defined in <tt>:setup_db_connection</tt> LWRP action for the <tt>app::setup_db_connection</tt> recipe.

* <tt>web_xml.erb</tt> - Content configuration template for Jboss.
* <tt>context_xml.erb</tt> - Configuration for project database connection
  config file.

=== LWRPs:

<tt>app_jboss</tt> Lightweight provider is defined in the
<tt>providers/default.rb</tt> file and contains source for the following actions:

* <tt>:install</tt>

* <tt>:setup_vhost</tt>

* <tt>:start</tt>

* <tt>:stop</tt>

* <tt>:reload</tt>

* <tt>:restart</tt>

* <tt>:code_update</tt>

* <tt>:setup_db_connection</tt>

* <tt>:setup_monitoring</tt>


For more info about these actions please see <tt>app</tt> cookbook README.

For normal operations it requires the "app" resource which will act as an 
interface to all <tt>app_jboss</tt> provider logic.

===== Actions

* <tt>:install</tt> - Install packages required for application server setup.

* <tt>:setup_vhost</tt> - Set up Apache vhost file, with Jboss module
  directives included. Install and set up Jboss package dependencies.

* <tt>:start</tt> - Start sequence for Jboss application server.

* <tt>:stop</tt> - Stop sequence for Jboss application server.

* <tt>:reload</tt> - Reload sequence for Jboss application server.

* <tt>:restart</tt> - Restart sequence for Jboss application server.

* <tt>:code_update</tt> - Perform project source code update/download using user
  selected "repo" LWRP. Set up logrotate config.

* <tt>:setup_db_connection</tt> - Perform project
  <tt>/etc/jboss/context.xml</tt> database file configuration.

* <tt>:setup_monitoring</tt> - Install and set up of required monitoring software.

===== Usage Example:

For usage examples, please see corresponding section in <tt>app</tt> cookbook README.

= LICENSE:

Copyright RightScale, Inc. All rights reserved.  All access and use subject to the
RightScale Terms of Service available at http://www.rightscale.com/terms.php and,
if applicable, other agreements such as a RightScale Master Subscription Agreement.
